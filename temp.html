

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="content-type" content="text/html;charset=UTF-8;">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=no">
  <link href="https://s.chuimg.com/favicon.ico" rel="shortcut icon">
  <title>滑动验证</title>
  <style>
    body {
        display: -webkit-box;
        display: flex;
        -webkit-box-pack: center;
        justify-content: center;
        -webkit-box-align: center;
        align-items: center;
        margin: 0;
        padding: 0;
        height: 100vh;
    }
    #nc_1_wrapper {
        margin: 0 auto;
    }
    #aliyundun-validate {
      position: static !important;
    }
  </style>
  <script src="https://g.alicdn.com/AWSC/AWSC/awsc.js"></script>
</head>

<body>
<div style="position: relative">
  <p style="text-align: center">请滑动完成验证</p>
  <div id="aliyundun-validate">
  </div>
</div>

<script src="//sv2.chuimg.com/dist/1ce090a0884a9966b736.js"></script>
<script src="//sv2.chuimg.com/dist/d10097432fadcded3bdb.js"></script>
<script>
      var inApp = document.cookie.indexOf('app_origin') > -1
      var inMiniprogram = navigator.userAgent.indexOf('miniProgram') > -1 || window.__wxjs_environment === 'miniprogram'
      if (inMiniprogram) {
        var sc = document.createElement('script')
        sc.src = '//res.wx.qq.com/open/js/jweixin-1.6.0.js'
        document.head.appendChild(sc)
        sc = null
      }
      AWSC.use("nc", function (state, module) {
        window.nc = module.init({
          appkey: "FFFF000000000182DB50",
          scene: "nc_bbs_h5",
          renderTo: "aliyundun-validate",
          success: function (data) {
              $.post('/auth/humancheck_captcha/', {sig: data.sig, token: data.token, session_id: data.sessionId, xf: "None", xcf_token: "9thztNEc8UvPMb06r7/T64c3r1SCVFWtenKuSX455cLGA+7hwnibxIzCGDYmP/BA", next: "/recipe/100584537/" })
              .done(function (res) {
                  var has_passed = res.content ? res.content.has_passed : false;
                  var redirect = res.content ? res.content.redirect : null;

                  if (has_passed) {
                      if (inApp) {
                        // js主动调起的验证，增加了 'autoclose' 参数
                        if (location.search.indexOf('autoclose') > -1) {
                          jsBridge.close()
                          return
                        }
                        location.href = "/auth/humancheck_captcha/success";
                      } else if (window.name === 'verificationWindow') {
                        // window.open() 打开的
                        window.onverify('success')
                      } else if (inMiniprogram) {
                        // 微信小程序
                        wx.miniProgram.navigateBack()
                      } else {
                        if (redirect) {
                          window.location.href = redirect
                        }
                        else {
                          window.history.back()
                        }
                      }
                      return
                  } else {
                      alert("验证失败，请重试");
                      if (redirect) {
                          window.location.href = redirect
                      }
                  }
                  if (res.msg) {
                      alert(res.msg);
                  }
                  window.nc.reset();
              }).fail(function (err) {
                  alert("请求失败，请重试");
                  window.nc.reset();
              })
          },
          fail: function (failCode) {
            window.nc.reset();
          },
          error: function (errorCode) {
            location.reload();
          },
        });
      });
    </script>
</body>
</html>
